dist: xenial
language: bash
addons:
  apt:
    packages:
    - aria2
    - zip
    - unzip
before_script:
- sudo apt-get update -qq
- sudo apt-get install aria2 zip unzip check -qq
script:
- source ./env.sh
- "${DLR} ${ROOTFS_URL} -o ${ROOTFS_TGZ}"
- "${DLR} ${LNCR_URL} -o ${LNCR_ZIP}"
- 
- unzip ${LNCR_ZIP} ${LNCR_FN}
- sudo tar -zxpf ${ROOTFS_TGZ}
- 
- sudo losetup --partscan /dev/loop0 ${ROOTFS_FN}
- sudo mkdir mntfs
- sudo mount -o ro /dev/loop0p1 mntfs
- sudo cp -a mntfs rootfs
- sudo umount mntfs
- 
- echo "# This file was automatically generated by WSL. To stop automatic generation
  of this file, remove this line." | sudo tee ./rootfs/etc/resolv.conf
- 
- cd rootfs
- sudo tar -zcpf ../rootfs.tar.gz *
- sudo chown `id -un` ../rootfs.tar.gz
- cd ..
- 
- mkdir out
- mv -f ${LNCR_FN} ./out/
- mv -f rootfs.tar.gz ./out/
- cd out
- zip CentOS.zip *
- cd ..
notifications:
  email: false
deploy:
  provider: releases
  api_key:
    secure: J6pm0XP9qr0SM/TSA40mlEo+s5bOAprd0gVmbuJc8LbaimZb7A03fABdMCnPYv4Xz+UGij/w0FsrLT45zgLi5S8A2G+tld2G4eRvtyo8QK2MavQMiyEY7Lt9opvLDi/uGyKexnk+fUBzaeGIE8FlDrbPThwkvulS/FsPITXPW5JVedSsMOHj6UfT0Y3Pv/NZODMhus4O1vHhCFOGnrBHccBjV+F6bdmrMdWyqN53A5C7EBzrhZWhx9ecoLZA8vK6zUUDWiyt5tfkjs1c0NHEDySbm1pi3xqxXjoTB/pTE6VsHBEW9YU6HMn1U/0K9sLNqcbRnOduKw9HvaPMjigK58tqSTU6cfhXDTA6tpCPP6He0eKXYryNJiQNK9RTzt2jZ5NzPPTYAkY1pPcq6xvadbzZOBUiNd9WXr2WKiAshjUMNQLw0DCJZlQcKyr0y5WbyHFhA8Me4Q0n2/SuDon4KLJ15IqX91UEB6MZ9CXjjiQ7QAG7q1kIHUMFDM0WGh4gCvGdLPQdle1bHsAwTapWjjWXN09wDCNNt9jrIB3otTjoCuTk528t/737IBvFiK6zpYU6LNTiQD1hBEHuKDRMjJyAf3GWl+erqpndhwwHJSs9fe4hzqM6GiYJxXRHU8Ddp78nAi0nrWIUVt0qUDpVbvZJdyPidFOj9jdQprHHhMQ= 
  file: out/CentOS.zip
  on:
    repo: gisjedi/CentWSL
    tags: true
    all_branches: true
  skip_cleanup: true
